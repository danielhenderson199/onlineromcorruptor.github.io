<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Danilabs ROM Glitcher PRO</title>
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    .container {
      background: #222;
      border: 2px solid #0f0;
      padding: 2rem;
      border-radius: 10px;
      max-width: 600px;
      width: 100%;
      text-align: center;
    }

    button, select, input[type="file"], input[type="range"] {
      margin: 0.7rem 0;
    }

    button {
      padding: 0.6rem 1.5rem;
      background: #0f0;
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
    }

    button:hover {
      background: #5f5;
    }

    #romInfo {
      font-size: 0.9rem;
      margin-top: 1rem;
      background: #000;
      padding: 1rem;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ROM Glitcher PRO</h1>

    <input type="file" id="romFile" accept=".nes,.smd,.bin,.gen,.sms,.smc,.gba,.gb" />
    
    <div id="romInfo">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ ROM –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>

    <label for="glitchLevel">–£—Ä–æ–≤–µ–Ω—å –∏—Å–∫–∞–∂–µ–Ω–∏—è: <span id="glitchValue">10%</span></label><br>
    <input type="range" id="glitchLevel" min="0" max="100" value="10" />

    <br />
    <label for="glitchMode">–†–µ–∂–∏–º –∏—Å–∫–∞–∂–µ–Ω–∏—è:</label><br>
    <select id="glitchMode">
      <option value="random">üîÄ –°–ª—É—á–∞–π–Ω—ã–π</option>
      <option value="graphics">üé® –¢–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–∞</option>
      <option value="logic">üß† –¢–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞</option>
      <option value="sound">üîá –¢–æ–ª—å–∫–æ –∑–≤—É–∫</option>
    </select>

    <br />
    <label>
      <input type="checkbox" id="fixChecksum" />
      üß© –ò—Å–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫—Å—É–º (–¥–ª—è Sega ROM .bin/.smd)
    </label>

    <br /><br />
    <button id="glitchButton">–ò—Å–∫–∞–∂–∞—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å ROM</button>
    <p id="status"></p>
  </div>

  <script>
    const fileInput = document.getElementById('romFile');
    const glitchLevel = document.getElementById('glitchLevel');
    const glitchValue = document.getElementById('glitchValue');
    const glitchMode = document.getElementById('glitchMode');
    const button = document.getElementById('glitchButton');
    const status = document.getElementById('status');
    const romInfo = document.getElementById('romInfo');

    glitchLevel.addEventListener('input', () => {
      glitchValue.textContent = glitchLevel.value + '%';
    });

    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (!file) return;
      romInfo.innerHTML = `
        üì¶ –ò–º—è: <b>${file.name}</b><br>
        üìÅ –†–∞–∑–º–µ—Ä: <b>${file.size} –±–∞–π—Ç</b><br>
        üìÄ –§–æ—Ä–º–∞—Ç: <b>${file.name.split('.').pop().toUpperCase()}</b>
      `;
    });

    function fixGenesisChecksum(buffer) {
      if (buffer.length < 0x200) return;
      let sum = 0;
      for (let i = 0x200; i < buffer.length; i += 2) {
        const hi = buffer[i] || 0;
        const lo = buffer[i + 1] || 0;
        sum = (sum + ((hi << 8) | lo)) & 0xFFFF;
      }
      buffer[0x18E] = (sum >> 8) & 0xFF;
      buffer[0x18F] = sum & 0xFF;
    }

    button.addEventListener('click', () => {
      const file = fileInput.files[0];
      if (!file) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ ROM-—Ñ–∞–π–ª!');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        let buffer = new Uint8Array(e.target.result);
        const glitchAmount = parseInt(glitchLevel.value);
        const mode = glitchMode.value;
        const safeZone = 2048;
        const size = buffer.length;
        let start = safeZone, end = size;

        if (mode === 'graphics') {
          start = Math.floor(size * 0.5);
          end = size;
        } else if (mode === 'logic') {
          start = safeZone;
          end = Math.floor(size * 0.5);
        } else if (mode === 'sound') {
          start = Math.floor(size * 0.75);
          end = size;
        }

        const changes = Math.floor((end - start) * glitchAmount / 100);
        for (let i = 0; i < changes; i++) {
          const index = Math.floor(Math.random() * (end - start)) + start;
          buffer[index] = Math.floor(Math.random() * 256);
        }

        if (document.getElementById('fixChecksum').checked) {
          fixGenesisChecksum(buffer);
        }

        const blob = new Blob([buffer], { type: "application/octet-stream" });
        const url = URL.createObjectURL(blob);

        const link = document.createElement("a");
        link.href = url;
        link.download = "GLITCHED_" + file.name;
        link.click();

        status.textContent = `‚úÖ ROM –∏—Å–∫–∞–∂—ë–Ω. –£—Ä–æ–≤–µ–Ω—å: ${glitchAmount}%, —Ä–µ–∂–∏–º: ${mode}`;
      };

      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>
